const mysql = require('mysql2/promise');
require('dotenv').config();

async function initRewards() {
    const connection = await mysql.createConnection({
        host: process.env.DB_HOST,
        port: process.env.DB_PORT || 3306,
        user: process.env.DB_USER,
        password: process.env.DB_PASSWORD,
        database: process.env.DB_NAME,
        charset: 'utf8mb4'
    });

    try {
        console.log('ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ');

        // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
        await connection.query('DELETE FROM PointExchange');
        await connection.query('DELETE FROM Reward');
        console.log('ê¸°ì¡´ ë³´ìƒ ë°ì´í„° ì‚­ì œ ì™„ë£Œ');

        // ìŒë£Œ/ë³´ì¶©ì œ
        const beverages = [
            ['í”„ë¡œí‹´ ì‰ì´í¬', 150, 50, 'ìŒë£Œ/ë³´ì¶©ì œ', 'ğŸ¥¤', 'ê³ ë‹¨ë°± í”„ë¡œí‹´ ì‰ì´í¬ 1íšŒë¶„'],
            ['ìŠ¤í¬ì¸  ìŒë£Œ', 80, 200, 'ìŒë£Œ/ë³´ì¶©ì œ', 'ğŸ§ƒ', 'ì „í•´ì§ˆ ë³´ì¶© ìŠ¤í¬ì¸  ìŒë£Œ'],
            ['ì—ë„ˆì§€ë°” 5ê°œ', 120, 100, 'ìŒë£Œ/ë³´ì¶©ì œ', 'ğŸ«', 'ìš´ë™ ì „í›„ ê°„í¸ ì—ë„ˆì§€ë°”'],
            ['BCAA ë³´ì¶©ì œ', 250, 30, 'ìŒë£Œ/ë³´ì¶©ì œ', 'ğŸ’Š', 'ê·¼ìœ¡ íšŒë³µ BCAA ë³´ì¶©ì œ'],
            ['í¬ë ˆì•„í‹´ ë³´ì¶©ì œ', 280, 25, 'ìŒë£Œ/ë³´ì¶©ì œ', 'ğŸ’Š', 'ê·¼ë ¥ í–¥ìƒ í¬ë ˆì•„í‹´']
        ];

        // ìš´ë™ ìš©í’ˆ
        const equipment = [
            ['ìš´ë™ íƒ€ì˜¬', 150, 100, 'ìš´ë™ ìš©í’ˆ', 'ğŸ§»', 'ê³ ê¸‰ ìŠ¤í¬ì¸  íƒ€ì˜¬'],
            ['ìš´ë™ ì¥ê°‘', 200, 50, 'ìš´ë™ ìš©í’ˆ', 'ğŸ§¤', 'ë…¼ìŠ¬ë¦½ ìš´ë™ ì¥ê°‘'],
            ['í—¬ìŠ¤ ë²¨íŠ¸', 350, 30, 'ìš´ë™ ìš©í’ˆ', 'âš«', 'í—ˆë¦¬ ë³´í˜¸ í—¬ìŠ¤ ë²¨íŠ¸'],
            ['ë¬´ë¦ ë³´í˜¸ëŒ€', 250, 40, 'ìš´ë™ ìš©í’ˆ', 'ğŸ¦µ', 'ë¬´ë¦ ë³´í˜¸ ìŠ¬ë¦¬ë¸Œ'],
            ['ì†ëª© ë³´í˜¸ëŒ€', 180, 60, 'ìš´ë™ ìš©í’ˆ', 'ğŸ’ª', 'ì†ëª© ë³´í˜¸ ë©'],
            ['ìš”ê°€ ë§¤íŠ¸', 400, 20, 'ìš´ë™ ìš©í’ˆ', 'ğŸ§˜', 'í”„ë¦¬ë¯¸ì—„ ìš”ê°€ ë§¤íŠ¸'],
            ['ì§ë°±', 450, 15, 'ìš´ë™ ìš©í’ˆ', 'ğŸ’', 'ëŒ€ìš©ëŸ‰ ìŠ¤í¬ì¸  ë°±']
        ];

        // ì´ìš©ê¶Œ
        const tickets = [
            ['PT 1íšŒ ë¬´ë£Œ ì´ìš©ê¶Œ', 300, 30, 'ì´ìš©ê¶Œ', 'ğŸ«', 'í¼ìŠ¤ë„ íŠ¸ë ˆì´ë‹ 1íšŒ'],
            ['PT 5íšŒ ë¬´ë£Œ ì´ìš©ê¶Œ', 1200, 10, 'ì´ìš©ê¶Œ', 'ğŸŸï¸', 'í¼ìŠ¤ë„ íŠ¸ë ˆì´ë‹ 5íšŒ'],
            ['í—¬ìŠ¤ì¥ 1ê°œì›” ë¬´ë£Œ ì´ìš©ê¶Œ', 500, 20, 'ì´ìš©ê¶Œ', 'ğŸ‹ï¸', 'í—¬ìŠ¤ì¥ 1ê°œì›” ì—°ì¥'],
            ['í—¬ìŠ¤ì¥ 3ê°œì›” ë¬´ë£Œ ì´ìš©ê¶Œ', 1300, 5, 'ì´ìš©ê¶Œ', 'ğŸ‹ï¸', 'í—¬ìŠ¤ì¥ 3ê°œì›” ì—°ì¥'],
            ['ë½ì»¤ 1ê°œì›” ë¬´ë£Œ ì´ìš©', 400, 15, 'ì´ìš©ê¶Œ', 'ğŸ”', 'ê°œì¸ ë½ì»¤ 1ê°œì›”']
        ];

        // ì˜ë¥˜
        const clothing = [
            ['ìš´ë™ë³µ ìƒì˜', 500, 25, 'ì˜ë¥˜', 'ğŸ‘•', 'ê¸°ëŠ¥ì„± ìš´ë™ë³µ ìƒì˜'],
            ['ìš´ë™ë³µ í•˜ì˜', 450, 30, 'ì˜ë¥˜', 'ğŸ‘–', 'ê¸°ëŠ¥ì„± ìš´ë™ë³µ í•˜ì˜'],
            ['ìš´ë™í™” í• ì¸ê¶Œ 50%', 600, 15, 'ì˜ë¥˜', 'ğŸ‘Ÿ', 'ìš´ë™í™” 50% í• ì¸'],
            ['í—¬ìŠ¤ì¥ í›„ë“œí‹°', 700, 10, 'ì˜ë¥˜', 'ğŸ§¥', 'í—¬ìŠ¤ì¥ ë¡œê³  í›„ë“œí‹°']
        ];

        // ê¸°íƒ€
        const others = [
            ['í—¬ìŠ¤ì¥ ë¬¼ë³‘', 180, 80, 'ê¸°íƒ€', 'ğŸ¶', 'ìŠ¤í…Œì¸ë¦¬ìŠ¤ ë¬¼ë³‘'],
            ['ë¸”ë£¨íˆ¬ìŠ¤ ì´ì–´í°', 800, 8, 'ê¸°íƒ€', 'ğŸ§', 'ë¬´ì„  ìŠ¤í¬ì¸  ì´ì–´í°'],
            ['ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ í• ì¸ê¶Œ 30%', 1000, 5, 'ê¸°íƒ€', 'âŒš', 'ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ 30% í• ì¸'],
            ['ë§ˆì‚¬ì§€ ê±´', 1500, 3, 'ê¸°íƒ€', 'ğŸ”«', 'ê·¼ìœ¡ ì´ì™„ ë§ˆì‚¬ì§€ ê±´']
        ];

        const allRewards = [...beverages, ...equipment, ...tickets, ...clothing, ...others];

        for (const reward of allRewards) {
            await connection.query(
                'INSERT INTO Reward (reward_name, required_points, stock_quantity, category, icon, description) VALUES (?, ?, ?, ?, ?, ?)',
                reward
            );
        }

        console.log(`âœ… ${allRewards.length}ê°œì˜ ë³´ìƒ ìƒí’ˆ ì¶”ê°€ ì™„ë£Œ`);

        // ì¶”ê°€ëœ ë°ì´í„° í™•ì¸
        const [results] = await connection.query('SELECT reward_id, reward_name, icon, category FROM Reward ORDER BY category, required_points');
        console.log('\nì¶”ê°€ëœ ë³´ìƒ ìƒí’ˆ:');
        results.forEach(r => {
            console.log(`  ${r.icon} ${r.reward_name} (${r.category})`);
        });

    } catch (error) {
        console.error('ì˜¤ë¥˜ ë°œìƒ:', error);
    } finally {
        await connection.end();
        console.log('\në°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ');
    }
}

initRewards();
